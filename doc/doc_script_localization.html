<html>
<head>
<title>Localization of scripts</title>
<style type="text/css">
body {
 font-size: 10pt;
 margin-left: 8px;
 margin-right: 8px;
 margin-top: 6px;
 margin-bottom: 6px;
 font-family:Verdana,Helvetica,Arial;
}
table, td, tr {
 font-size: 10pt;
 font-family:Verdana,Helvetica,Arial;
 color: #3c3c3c;
}
td {
 padding: 6px;
}
a:link {
 text-decoration: none;
 color: #2883e2;
}
a:visited {
 text-decoration: none;
 color: #6856cc;
}
a:hover {
 text-decoration: underline;
 color: #186CC4;
}
a:active {
 text-decoration: underline;
 color: #186CC4;
}
.title-table-cell {
 border-top-left-radius: 3px;
 border-top-right-radius: 3px;
 background-color: #F2DFB1;
}
.title-text {
 font-family:Verdana,Helvetica,Arial;
 font-size: 18pt;
 font-weight: bold;
 padding-bottom: 3px;
 color: #404040;
 text-shadow: 0px 2px 0px rgba(247,247,247,1);
}
.title-secondary-text {
 font-family:Verdana,Helvetica,Arial;
 font-size: 11pt;
 padding-top: 3px;
 color: #474747;
 text-shadow: 0px 2px 0px rgba(247,247,247,1);
}
.subtitle-table-cell {
 background-color: #D6D6D6;
}
.subtitle-text {
 font-family:Verdana,Helvetica,Arial;
 font-size: 11pt;
 color: #000000;
 text-shadow: 0px 1px 0px rgba(247,247,247,1);
}
.subsubtitle-table-cell {
 background-color: #E3E3E3;
}
.subsubtitle-text {
 font-family:Verdana,Helvetica,Arial;
 font-size: 10pt;
 color: #474747;
}
.syntax-text {
 font-family:"Lucida Console", Monaco, monospace, "Courier New";
 font-size: 10pt;
 font-weight: bold;
 white-space: pre;
 color: #800000;
}
.example-box {
 font-family:"Lucida Console", Monaco, monospace, "Courier New";
 font-size: 10pt;
 white-space: pre;
 background-color: #f5f5f5;
 border: 1px solid #d5d5d5;
 color: #800000;
 padding: 10px;
 margin-top: 6px;
 margin-bottom: 6px;
}
.example-box a:link {
 color: #600030;
}
.example-box a:visited {
 color: #600030;
}
.example-box a:hover {
 color: #FF2B46;
}
.example-box a:active {
 color: #FF2B46;
}
.comment-text {
 color: #578A57;
}
.comment-text a:link {
 color: #578A57;
}
.comment-text a:visited {
 color: #578A57;
}
.comment-text a:hover {
 color: #35BD58;
}
.comment-text a:active {
 color: #35BD58;
}
.example-paren {
 color: #8A7000;
}
.example-bracket {
 color: #9C7914;
}
.example-oper {
 color: #9C7914;
}
.example-variable {
 color: #AB6332;
}
.comment-text .example-variable {
 color: #578A57;
}
.comment-text .example-oper {
 color: #578A57;
}
.comment-text .example-paren {
 color: #578A57;
}
.comment-text .example-bracket {
 color: #578A57;
}
.switch-table {
 width: 100%;
 border-collapse: collapse;
}
.switch-title-table-cell {
 font-family:"Lucida Console", Monaco, monospace, "Courier New";
 font-size: 10pt;
 color: #670000;
 background-color: #EDEDED;
}
.switch-body-table-cell {
}
.footer {
 border-top: 1px solid #a2a2a2;
 color: #a2a2a2;
 margin-top: 8px;
 padding-top: 4px;
 font-style: italic;
 font-size: 8pt;
}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
</head>
<body bgcolor="#FFFFFF" text="#000000">
<table width="100%" cellpadding="1" cellspacing="0" border="0">
 <tr>
  <td align="left" bgcolor="#FFFFFF">
    <a href="index.html"><img src="helplogoleft.png" iorder="0"></a>
  </td>
  <td align="right" bgcolor="#FFFFFF">
    <img src="helplogoright.png">
  </td>
 </tr>
</table>
<table width="100%" cellpadding="3" cellspacing="0" border="0">
  <tr>
    <td class='title-table-cell'>
      <div class='title-text'>Localization of scripts</div>      <div class='title-secondary-text'>Explains how to add translation capabilities to your scripts</div>    </td>
  </tr>
  <tr bgcolor="#EAEAEA">
    <td><p>
</td></tr><tr><td class="subtitle-table-cell"><div class="subtitle-text">Introduction</div></td></tr><tr><td bgcolor="#EAEAEA">
</p>
<p>
Adding the translated versions of the strings adds a great
value to your scripts. The process of translating a part of
software is called localization. KVIrc offers some commands
and functions for this purpose and this document explains
briefly how to use them.
</p>
<p>
</td></tr><tr><td class="subtitle-table-cell"><div class="subtitle-text">The big picture</div></td></tr><tr><td bgcolor="#EAEAEA">
</p>
<p>
All of the strings in your script are written in a "primary language".
The most common "primary language" is English, but theoretically
it can be any language of your choice.
</p>
<p>
By the means of the gettext package programs you extract
the strings from your script and produce a translation file.
</p>
<p>
The translation file is then effectively translated in another
language and later compiled in a binary form.
</p>
<p>
The binary form translations are then loaded in the KVIrc
executable at runtime and a function is used to look up the
translations.
</p>
<p>
</td></tr><tr><td class="subtitle-table-cell"><div class="subtitle-text">How to translate scripts</div></td></tr><tr><td bgcolor="#EAEAEA">
</p>
<p>
Your strings should be surrounded by the <a href="fnc_tr.html">$tr</a>() function in the following way:
<div class="example-box"><a href="fnc_tr.html">$tr</a><span class="example-paren">(</span>"your default language text"<span class="example-paren">)</span>
</div>
</p>
<p>
Then you should run the xgettext command on your script files.
This is done by a shell commandline similar to the following:<br>
<pre>xgettext -o myscript.pot -ktr mykvsfile1.kvs mykvsfile2.kvs ...</pre>
</p>
<p>
Copy the translation file obtained in the following way:<br>
<pre>cp myscript.pot myscript_XX.pot</pre>
Where the XX is your country/language code. For example, for Italian
it would be:<br>
<pre>cp myscript.pot myscript_it.po</pre>
</p>
<p>
Translate mytranslation_it.po. The format of the po file is straightforward.
There are msgid lines with the original English text and immediately
following msgstr lines that must be filled with the corresponding translation.
For example in Italian you would translate:<br>
msgid "your default language text"
msgstr "il tuo testo in linguaggio predefinito"
</p>
<p>
Compile your translation to binary form with the following command:<br>
<pre>msgfmt -o myscript_it.mo myscript_it.po</pre>
</p>
<p>
Copy the generated *.mo file to the "locale" subdirectory
in the KVIrc's local directory (usually $HOME/.kvirc/locale/).
</p>
<p>
Set the system language to the XX above with the following command:<br>
<pre>export LANG="XX"</pre><br>
For Italian it would be:<br>
<pre>export LANG="it"</pre><br>
</p>
<p>
Start KVIrc and type in the commandline:
<div class="example-box"><a href="cmd_echo.html">echo</a> <a href="fnc_tr.html">$tr</a><span class="example-paren">(</span>"your default language text","myscript"<span class="example-paren">)</span>
</div>
If you did everything well, you should see the translated
text echoed in the window :)<br>
</p>
<p>
Obviously if you don't set LANG="XX", the same command will
output the original string unchanged.
</p>
<p>
You can manage translations in several languages by producing
several *.mo files all with the proper language/country code appended.
The right *.mo file will be magically loaded by KVIrc that
will look up the user's LANG variable. (If you don't want
to use LANG, you can use KVIRC_LANG instead, it will still work).
</p>
</td></tr><tr><td class="subtitle-table-cell"><div class="subtitle-text">Caveats</div></td></tr><tr><td bgcolor="#EAEAEA">
</p>
<p>
You should NEVER use variables or identifiers inside the $tr() function.
This because the translation files are generated offline,
when the string is not evaluated yet (i.e variables ad identifiers
are not substituted by their actual return values).
The translation process, instead, happens at runtime, when
the variables and identifiers have been substituted by their
actual values. This would lead to a mismatch between the
string you look up in the translation catalogue and the
effectively translated one. If you need to include variables
in your strings you should compose the string with smaller pieces
<div class="example-box"><a href="cmd_echo.html">echo</a> <a href="fnc_tr.html">$tr</a><span class="example-paren">(</span>"On this channel"<span class="example-paren">)</span> <span class="example-variable">%number</span> <a href="fnc_tr.html">$tr</a><span class="example-paren">(</span>"users are operators"<span class="example-paren">)</span>
</div>
</p>
<p>
The translation process can be realized only if your
scripts are written in external files. This makes sense since
if you're translating the script then you will probably want to
distribute it and the only way to distribute it is on files.
But well.. this is a caveat.
</p>
</td>
  </tr>
</table>
<hr><a href="index.html">Index</a>, <a href="doc_generic_index_all.html">Miscellaneous</a>
<div class='footer'>KVIrc 4.9.1.git-6259-g8df76d1 Documentation - generated by un1versal on Mon Feb 29 12:49:04 2016</div>
</body>
</html>
